Εζεκελιάν Αναΐτ (sdi1900056)
Μάλλιος Χρήστος-Ιωάννης (sdi1900106)

/////////////// COMPILE - RUN /////////////////

Για μεταγλώττιση του προγράμματος: make
Για εκτέλεση του προγράμματος:
---> ./cmpcats -d dirA dirB Για να συγκρίνουμε δύο φακέλους  
---> ./cmpcats -d dirA dirB -s dirC Για να συγχωνεύσουμε τους δύο φακέλους dirA, diB στον τρίτο φάκελο dirC

Για διαγραφή των object files: make clean

cmpcats.c:
Το αρχείο αυτό περιέχει τη συνάρτηση main, η οποία διαχειρίζεται τις σημαίες στη γραμμή εντολών και τα ορίσματα και καλεί στην περίπτωση των 2 ορισμάτων τη συνάρτηση compareDirectories(dirA,dirB) για τη σύγκριση των 2 φακέλων και στην περίπτωση των 6 ορισμάτων τη συνάρτηση mergeDirectories(dirA,dirB,dirC).

compareDirectories.c:
Το αρχείο αυτό περιέχει τις συναρτήσεις που είναι υπεύθυνες για τη διαδικασία της σύγκρισης των φακέλων. Συγκεκριμένα, οι συναρτήσεις είναι:

---> compareFileContents(const char *fileA, const char *fileB)
Η συνάρτηση αυτή συγκρίνει τα περιεχόμενα δύο αρχείων filA και fileB. Αρχικά υπολογίζει το μέγεθος του αρχείου με τη χρήση της lseek και στη συνέχεια συγκρίνει με την memcmp τα περιεχόμενα των αρχείων, μόνο για την περίπτωση που τα δύο αρχεία έχουν το ίδιο μέγεθος. Επιστρέφει 1 αν τα αρχεία είναι ίδια, διαφορετικά επιστρέφει 0.

---> int findDifferences(const char *dirA, const char *dirB, List commonPaths, List differentPaths)
Η συνάρτηση αυτή, ελέγχει ποια από τα στοιχεία του φακέλου Α υπάρχουν στον φάκελου Β και ποια είναι διαφορετικά και τα αποθηκεύει στις λίστες commonPaths και differentPaths αντίστοιχα. Ο έλεγχος γίνεται βάσει των κριτηριών που περιγράφονται στην εκφώνηση, για φακέλους, αρχεία και συνδέσμους. Σε κάθε άλλη περίπτωση τα στοιχεία θεωρούνται διαφορετικά. Στην περίπτωση που ένας φάκελος του φακέλους Α, δεν υπάρχει στον φάκελο Β, γίνεται έλεγχος και αναδρομική κλήση της συνάρτησης, ώστε τα περιεχόμενά του να αποθηκευτούν στη λίστα differentPaths.

---> void compareDirectories(char *dirA, char *dirB)
Η συνάρτηση αυτή, είναι υπέυθυνη για την κλήση της συνάρτηση findDifferences. Αρχικά δημιουργεί τις λίστες που δίνονται ως ορίσματα και καλεί τη findDifferences, μία φορά για να βρει τα κοινά και διαφορετικά στοιχεία από το Α στο Β και μία φορά για το αντίστροφο. Εκτυπώνει τις λίστες με τα διαφορετικά στοιχεία, ώστε να φαίνονται οι διαφορές των δύο φακέλων.

mergeDirectories.c:
Το αρχείο αυτό περιέχει τις συναρτήσεις που είναι υπεύθυνες για τη διαδικασία της συγχώνευσης των δύο φακέλων. Συγκεκριμένα οι συναρτήσεις είναι:

---> void copyFile(const char *src, const char *dest)
Η συνάρτηση αυτή, αντιγράφει ένα αρχείο από το src στο dest. Για ορίσματα δίνονται τα σχετικά μονοπάτια των αρχείων.
Η δημιουργεία των αρχείων γίνεται με τη συνάρτηση creat.

---> int copyDirectory(const char *source, const char *destination, List list)
Η συνάρτηση αυτή, αντιγράφει αναδρομικά έναν φάκελο από το source, στο destination. Η λίστα που δίνεται ως όρισμα, χρησιμεύει για να ελέγχουμε αν το στοιχείο που θα αντιγραφεί περιέχεται όντως στη λίστα αυτή. Για παράδειγμα, αν αντιγράφουμε τα κοινά στοιχεία, στη λίστα των οποίων υπάρχει ένας φάκελος που στην αρχική του θέση περιέχει ένα αρχείο, το οποίο όμως δεν είναι κοινό, με τον έλεγχο αυτό αποφεύγεται η λανθασμένη αντιγραφή του. Επιπλέον, η συνάρτηση επιστρέφει έναν counter ο οποίος αυξάνεται κάθε φορά που αντιγράφεται ένα στοιχείο. Με τον τρόπο αυτό αποφεύγονται οι άσκοπες συγκρίσεις με τα ήδη υπάρχοντα στοιχεία στο νέο φάκελο και οι διπλές εγγραφές.

---> void mergeDirectories(char *dirA, char *dirB, char \*dirC)
Η συνάρτηση αυτή, είναι υπέυθυνη για τη διαδικασία της συγχώνευσης. Πιο συγκεκριμένα, αρχικά καλεί τη συνάρτηση findDifferencies δύο φορές,αφού έχει δημιουργήσει τις δύο λίστες που δίνει ως ορίσματα. Αφού εκτελεστεί η σύγκριση, δημιουργεί το νέο φάκελο (Στην περίπτωση που ο φάκελος υπάρχει, επιχειρεί να τον διαγραψεί, όμως αυτό δεν είναι εφικτό με τη χρήση της rmdir στις περιπτώσεις που ο φάκελος δεν είναι άδειος), και αρχικά διατρέχει τα μισά στοιχεία (καθώς αυτά έχουν περαστεί 2 φορές από τη διπλή εκτέλεση της findDifferencies) της λίστα με τα κοινά στοιχεία και τα αντιγράφει στο νέο φάκελο. Στη συνέχεια ακολουθεί την ίδια διαδικασία για τα περιεχόμενα της λίστας με τα διαφορετικά στοιχεία, με τη διαφορά ότι ελέγχει το ενδεχόμενο κάποιο αρχείο να περιέχεται ήδη στο νέο φάκελο, οπότε και συγκρίνει τις ημερομηνίες τροποποίησης. Λαμβάνουμε υπόψην τις περιπτώσεις το στοιχείο να είναι φάκελος, όπου καλούμε τη συνάρτηση copyDirectory, να είναι αρχείο όπου καλούμε τη συνάρτηση copyFile ή να είναι σύνδεσμος, όπου δημιουργούμε το σύνδεσμο στο νέο φάκελο. Για να είναι σωστά τα σχετικά μονοπάτια για τα νέα στοιχεία που θα δημιουργηθούν, χρησιμοποιούμε τις συναρτήσεις strrchr και strstr ώστε να αντιγράφεται το ίδιο μονοπάτι που είχαν τα στοιχεία στους φακέλους προέλευσής τους, με τη διαφορά ότι ο πρώτος φάκελος θα είναι ο νέος που δημιουργήθηκε. Για παράδειγμα, αν το στοιχείο που θέλουμε να αντιγράψουμε είναι το dirA/dir1/dir11/file.txt, το μονοπάτι για το νέο φάκελο dirC θα είναι dirC/dir1/dir11/file.txt. Εξασφαλίζεται πως οι υποφάκελοι έχουν ήδη δημιουργηθεί από τη σειρά με την οποία τα στοιχεία αποθηκεύονται στις λίστες κατά τη διάρκεια της σύγκρισης.

Για τις πληροφορίες σχετικά με τα στοιχεία χρησιμοποιήσαμε την lstat αντί της stat, ώστε το μονοπάτι στην περίπτωση των συνδέσμων να οδηγεί στον σύνδεσμο και όχι στο αρχείο στο οποιο δείχνει.

list.c:
Το αρχείο περιέχει μια απλή υλοποίηση μιας απλά συνδεδεμένης λίστας. Οι συναρτήσεις που υπάρχουν στο αρχείο, αφορούν στη δημιουργία, την εύρεση του πλήθους των στοιχείων της λίστας, την εισαγωγή νέων στοιχείων, την εκτύπωση της λίστας, τη διαγραφή της καθώς και την αναζήτηση στα περιεχόμενά της.
